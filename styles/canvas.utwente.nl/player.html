<head>
	<script id="plyr-script" type="text/javascript" src="https://cdn.plyr.io/3.6.8/plyr.polyfilled.js"></script>
	<style>
		:root {
			--plyr-color-main: #cf0072;
		}
		html,
		body {
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100vh;
			overflow: hidden;
			background-color: black;
		}
		.plyr__video-wrapper {
			width: auto;
			height: 100vh;
		}
	</style>
	<link rel="stylesheet" href="https://cdn.plyr.io/3.6.8/plyr.css" />
</head>

<video id="player"></video>

<script>
	const urlParams = new URLSearchParams(window.location.search);
	const url = urlParams.get("url");

	const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);

	if (isChrome) {
		location.href = url;
	} else {
		fetch(url)
			.then((response) => response.text())
			.then((data) => {
				const playerEnv = JSON.parse(data.match(/ENV\s?=\s?({.*});/)[1]).media_object;

				const title = playerEnv.title;
				const sources = playerEnv.media_sources;
				const tracks = playerEnv.media_tracks;

				const player = new Plyr("#player", {
					controls: [
						"play-large", // The large play button in the center
						"play", // Play/pause playback
						"progress", // The progress bar and scrubber for playback and buffering
						"duration", // The full duration of the media
						"mute", // Toggle mute
						"volume", // Volume control
						"captions", // Toggle captions
						"settings", // Settings menu
						"pip", // Picture-in-picture (currently Safari only)
						"airplay", // Airplay (currently Safari only)
						"download", // Show a download button with a link to either the current source or a custom URL you specify in your options
						"fullscreen", // Toggle fullscreen,
						"title",
					],
				});

				player.source = {
					title,
					type: playerEnv.media_type.replace("/*", ""),
					sources: sources.map((source) => {
						return { src: source.url, type: source.content_type, size: source.height };
					}),
				};

				player.on("ready", (event) => {
					console.log("Player ready!");
				});
			})
			.catch((error) => {
				console.error("Error:", error);
			});
	}
</script>
